var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import"./main-Dacpvxy9.js";import"./game-top-bar-D2G5Ym00.js";import{C as i,b as s,S as r,R as n,c as a,d as h,G as o,a as c,e as l,A as d}from"./HTMLText-CcoN7BBX.js";class p{constructor(e,i,s){t(this,"sprite"),t(this,"id"),t(this,"originX"),t(this,"originY"),t(this,"dragOffset",{x:0,y:0}),t(this,"hole",null),t(this,"inPlay",!1),t(this,"stickerMaker"),t(this,"brightnessFilter"),this.sprite=e,this.id=i,this.originX=e.position.x,this.originY=e.position.y,this.stickerMaker=s,this.makeDraggable(),this.inPlay=!0,this.brightnessFilter=new l,this.sprite.filters=[this.brightnessFilter]}makeDraggable(){this.sprite.eventMode="static",this.sprite.cursor="pointer",this.sprite.on("pointerdown",e=>{if(!this.inPlay)return;const t=e.getLocalPosition(this.sprite.parent);this.dragOffset.x=t.x-this.sprite.position.x,this.dragOffset.y=t.y-this.sprite.position.y,this.sprite.parent.addChild(this.sprite);const i=new CustomEvent("startChunkDrag",{detail:{chunk:this,event:e}});document.dispatchEvent(i)})}checkSnapToHole(){Math.sqrt(Math.pow(this.sprite.position.x-this.originX,2)+Math.pow(this.sprite.position.y-this.originY,2))<m.snapThreshold/this.stickerMaker.currentGridSize&&(this.sprite.position.x=this.originX,this.sprite.position.y=this.originY,this.correctlyPlaced())}onDrop(){this.sprite.position.x<0&&(this.sprite.position.x=0),this.sprite.position.x>this.stickerMaker.gameWidth-this.sprite.width&&(this.sprite.position.x=this.stickerMaker.gameWidth-this.sprite.width),this.sprite.position.y<0&&(this.sprite.position.y=0),this.sprite.position.y>this.stickerMaker.gameHeight-this.sprite.height&&(this.sprite.position.y=this.stickerMaker.gameHeight-this.sprite.height),this.checkSnapToHole()}correctlyPlaced(){performance.now(),this.sprite.alpha=1,this.inPlay=!1,this.sprite.cursor="default",this.sprite.parent.setChildIndex(this.sprite,0);let e=0;const t=i=>{e+=i;const s=Math.min(e/60,1);let r;if(s<.25){const e=s/.25;r=2+e*e*4}else if(s<.9){const e=(s-.25)/1;r=4-3*(1-(1-e)*(1-e))}else r=1;this.brightnessFilter.brightness(r,!1),s>=1&&(this.sprite.filters=[],this.stickerMaker.app.ticker.remove(t))};this.stickerMaker.app.ticker.add(t),this.stickerMaker.createSnapParticles(this.sprite.position.x+this.sprite.width/2,this.sprite.position.y+this.sprite.height/2),performance.now(),setTimeout(()=>{this.sprite.eventMode="none"},1e3)}clamp(){this.sprite.position.x<0&&(this.sprite.position.x=0),this.sprite.position.x>this.stickerMaker.gameWidth-this.sprite.width&&(this.sprite.position.x=this.stickerMaker.gameWidth-this.sprite.width),this.sprite.position.y<0&&(this.sprite.position.y=0),this.sprite.position.y>this.stickerMaker.gameHeight-this.sprite.height&&(this.sprite.position.y=this.stickerMaker.gameHeight-this.sprite.height)}}class u{constructor(e,i,s){t(this,"id"),t(this,"chunk"),t(this,"graphics"),this.id=i,this.chunk=s,this.graphics=e}}class g{constructor(e,s,r,n,a){t(this,"app"),t(this,"game"),t(this,"gameContainer"),t(this,"currentStickerSprite",null),t(this,"gameWidth"),t(this,"gameHeight"),t(this,"holeContainer"),t(this,"chunkContainer"),t(this,"chunks",{}),t(this,"holes",{}),t(this,"activeChunk",null),t(this,"currentLevel"),t(this,"currentGridSize",m.gideSizeMedium),this.app=e,this.game=s,this.gameContainer=r,this.gameWidth=n,this.gameHeight=a,this.holeContainer=new i,this.chunkContainer=new i,this.setupStickerMakerEvents()}setupStickerMakerEvents(){document.addEventListener("startChunkDrag",e=>{const t=e,{chunk:i,event:s}=t.detail;this.handleStartDrag(i,s)})}handleStartDrag(e,t){this.activeChunk||(this.activeChunk=e)}async createSticker(e,t=m.gideSizeMedium){this.currentLevel=e,this.currentGridSize=t,performance.now();const i=await s.load(e.path);this.currentStickerSprite=new r(i);const n=.9*this.gameWidth,a=.9*this.gameHeight;if(this.currentStickerSprite.width>n||this.currentStickerSprite.height>a){const e=n/this.currentStickerSprite.width,t=a/this.currentStickerSprite.height,i=Math.min(e,t);this.currentStickerSprite.scale.set(i)}this.currentStickerSprite.anchor.set(.5,.5),this.currentStickerSprite.position.set(this.gameWidth/2,this.gameHeight/2),this.gameContainer.addChild(this.currentStickerSprite),this.gameContainer.addChild(this.holeContainer),this.gameContainer.addChild(this.chunkContainer),this.cutIntoTrianglesAndSquares(i,t),performance.now(),this.shuffleChunks()}cutIntoTrianglesAndSquares(e,t){const i=n.create({width:e.width,height:e.height}),s=new r(e);this.app.renderer.render(s,{renderTexture:i});const a=this.app.renderer.extract.canvas(i),h=a.getContext("2d").getImageData(0,0,a.width,a.height).data,o=e.width/t,c=e.height/t;for(let r=0;r<t;r++)for(let i=0;i<t;i++){const t=Math.round(i*o),s=Math.round(r*c),n=Math.round((i+1)*o),l=Math.round((r+1)*c);Math.random()>.5?this.createDraggableSquareFromTexture(t,s,n,l,e,h,a.width,a.height):Math.random()>.5?(this.createDraggableTriangleFromTexture(t,s,n,s,t,l,e,h,a.width,a.height),this.createDraggableTriangleFromTexture(n,s,n,l,t,l,e,h,a.width,a.height)):(this.createDraggableTriangleFromTexture(t,s,n,s,n,l,e,h,a.width,a.height),this.createDraggableTriangleFromTexture(t,s,n,l,t,l,e,h,a.width,a.height))}i.destroy(!0)}isPointInTriangleSimple(e,t,i,s,r,n,a,h){const o=(e-r)*(s-n)-(i-r)*(t-n),c=(e-a)*(n-h)-(r-a)*(t-h),l=(e-i)*(h-s)-(a-i)*(t-s);return!((o<0||c<0||l<0)&&(o>0||c>0||l>0))}createDraggableSquareFromTexture(e,t,i,s,n,o,c,l){if(!this.currentStickerSprite)throw new Error("Sticker sprite not found");let d=0;const u=(i-e)*(s-t);for(let r=t;r<s;r++)for(let t=e;t<i;t++)o[4*(r*c+t)+3]>128&&d++;if(d/u<m.visiblePercentage)return;const g=new a(e,t,i-e,s-t),k=new h(n.baseTexture,g),v=new r(k),S=this.currentStickerSprite.position.x-this.currentStickerSprite.width/2,C=this.currentStickerSprite.position.y-this.currentStickerSprite.height/2;v.position.set(S+e*this.currentStickerSprite.scale.x,C+t*this.currentStickerSprite.scale.y),v.scale.set(this.currentStickerSprite.scale.x,this.currentStickerSprite.scale.y);const f=new p(v,`chunk_${Object.keys(this.chunks).length+1}`,this);this.chunks[f.id]=f,this.chunkContainer.addChild(v),this.paintHoleFromSprite(f,i-e,s-t)}createDraggableTriangleFromTexture(e,t,i,s,r,n,c,l,d,u){if(!this.currentStickerSprite)throw new Error("Sticker sprite not found.");const g=Math.min(e,i,r),k=Math.min(t,s,n),v=Math.max(e,i,r),S=Math.max(t,s,n);let C=0,f=0;for(let a=k;a<=S;a++)for(let h=g;h<=v;h++)this.isPointInTriangleSimple(h,a,e,t,i,s,r,n)&&(f++,l[4*(a*d+h)+3]>128&&C++);if(0===f)return;if(C/f<m.visiblePercentage)return;const y=Math.min(e,i,r),w=Math.min(t,s,n),M=Math.max(e,i,r),b=Math.max(t,s,n),x=new a(y,w,M-y,b-w),L=new h(c.baseTexture,x),T=new o;T.beginTextureFill({texture:L}),T.moveTo(e-y,t-w),T.lineTo(i-y,s-w),T.lineTo(r-y,n-w),T.lineTo(e-y,t-w),T.endFill();const E=this.currentStickerSprite.position.x-this.currentStickerSprite.width/2,P=this.currentStickerSprite.position.y-this.currentStickerSprite.height/2;T.position.set(E+y*this.currentStickerSprite.scale.x,P+w*this.currentStickerSprite.scale.y),T.scale.set(this.currentStickerSprite.scale.x,this.currentStickerSprite.scale.y);const D=new p(T,`chunk_${Object.keys(this.chunks).length+1}`,this);this.chunks[D.id]=D,this.chunkContainer.addChild(T),this.paintHoleFromSprite(D,M-y,b-w)}paintHoleFromSprite(e,t,i){if(!this.currentStickerSprite)throw new Error("Sticker sprite not found");let s;s=e.sprite instanceof r?new r(e.sprite.texture):e.sprite.clone(),s.position.set(0,0),s.scale.set(1,1);const a=n.create({width:t,height:i});this.app.renderer.render(s,{renderTexture:a});const h=this.app.renderer.extract.canvas(a).getContext("2d").getImageData(0,0,t,i).data,c=Math.floor(156*Math.random())+50<<16|Math.floor(156*Math.random())+50<<8|Math.floor(156*Math.random())+50,l=new o;for(let r=0;r<i;r++)for(let i=0;i<t;i++)h[4*(r*t+i)+3]>200&&(l.beginFill(c),l.drawRect(e.sprite.position.x+i*e.sprite.scale.x,e.sprite.position.y+r*e.sprite.scale.y,1,1),l.endFill());this.holeContainer.addChild(l);const d=new u(l,e.id,e);this.holes[e.id]=d,e.hole=d,a.destroy(!0)}shuffleChunks(){if(!this.currentStickerSprite)return;const e=.1*this.gameWidth;for(const t of Object.values(this.chunks)){const i=Math.random()>.5;t.sprite.position.x=i?Math.random()*e:this.gameWidth-e+Math.random()*e,t.sprite.position.y=Math.random()*this.gameHeight,t.clamp()}}clampChunksToScreen(){for(const e of Object.values(this.chunks))e.clamp()}onMove(e){if(this.activeChunk){const t=e.getLocalPosition(this.activeChunk.sprite.parent);this.activeChunk.sprite.position.x=t.x-this.activeChunk.dragOffset.x,this.activeChunk.sprite.position.y=t.y-this.activeChunk.dragOffset.y}}onUp(){this.activeChunk&&(this.activeChunk.onDrop(),this.activeChunk=null,this.checkIfAllChunksArePlaced()&&(this.celebrate(),this.game.setLevelCompleted(this.currentLevel.id)))}createSnapParticles(e,t){for(let i=0;i<30;i++){const s=new o,r=4*Math.random()+2;s.beginFill(16777215),s.drawCircle(0,0,r),s.endFill(),s.position.set(e,t);const n=2*Math.PI*i/30+.8*(Math.random()-.5),a=3*Math.random()+4,h=Math.cos(n)*a,c=Math.sin(n)*a;this.gameContainer.addChild(s);let l=30;const d=.3;let p=h,u=c;const g=e=>{l-=e,u+=d*e,s.position.x+=p*e,s.position.y+=u*e,s.alpha=l/30;const t=l/30+.1;s.scale.set(t),l<=0&&(this.app.ticker.remove(g),this.gameContainer.removeChild(s),s.destroy())};this.app.ticker.add(g)}}checkIfAllChunksArePlaced(){return Object.values(this.chunks).every(e=>!1===e.inPlay)}cleanup(){for(const e of Object.values(this.chunks))e.sprite.parent&&e.sprite.parent.removeChild(e.sprite),e.sprite.destroy({children:!0});for(const e of Object.values(this.holes))e.graphics.parent&&e.graphics.parent.removeChild(e.graphics),e.graphics.destroy();this.currentStickerSprite&&(this.currentStickerSprite.parent&&this.currentStickerSprite.parent.removeChild(this.currentStickerSprite),this.currentStickerSprite.destroy(),this.currentStickerSprite=null),this.holeContainer.removeChildren(),this.chunkContainer.removeChildren(),this.chunks={},this.holes={},this.activeChunk=null,this.holeContainer.parent&&this.holeContainer.parent.removeChild(this.holeContainer),this.chunkContainer.parent&&this.chunkContainer.parent.removeChild(this.chunkContainer)}celebrate(){const e=s.get("/arcade/assets/stickers/star.png"),t=this.gameWidth/2,i=this.gameHeight/2;for(let s=0;s<20;s++){const n=new r(e);n.anchor.set(.5,.5),n.position.set(t,i);const a=.8*Math.random()+.4;n.scale.set(a),this.gameContainer.addChild(n);const h=2*Math.PI*s/20+.5*(Math.random()-.5),o=4*Math.random()+3,c=Math.cos(h)*o,l=Math.sin(h)*o;let d=120;const p=.05;let u=c,g=l;const m=e=>{d-=e,g+=p*e,n.position.x+=u*e,n.position.y+=g*e;const t=d/120;n.alpha=t,n.scale.set(a*t),n.rotation+=.1*e,d<=0&&(this.app.ticker.remove(m),this.gameContainer.removeChild(n),n.destroy())};this.app.ticker.add(m)}setTimeout(()=>{const e=new c("⭐ Puzzle Completed! ⭐");e.style.fontSize=48,e.style.fill="#FFD700",e.style.stroke="#000000",e.style.strokeThickness=5,e.style.fontFamily="Arial, sans-serif",e.style.fontWeight="bold",e.anchor.set(.5,.5),e.position.set(this.gameWidth/2,this.gameHeight-50),this.gameContainer.addChild(e),e.alpha=0,e.scale.set(.5);let t=0;const i=s=>{t+=s;const r=Math.min(t/30,1),n=1-(1-r)*(1-r);e.alpha=n,e.scale.set(.5+.5*n),r>=1&&this.app.ticker.remove(i)};this.app.ticker.add(i),setTimeout(()=>{e.parent&&(this.gameContainer.removeChild(e),e.destroy(),this.game.showReturnButton())},3e3)},500)}}const m={gideSizeSmall:3,gideSizeMedium:5,gideSizeLarge:7,snapThreshold:100,visiblePercentage:.1},k=()=>({gameWidth:window.innerWidth,gameHeight:window.innerHeight-48,topBarHeight:48,scale:1}),v=[{id:"lion_1",path:"/arcade/assets/stickers/lion.png"},{id:"elephant_1",path:"/arcade/assets/stickers/elephant.png"},{id:"chimp_1",path:"/arcade/assets/stickers/chimp.png"},{id:"husky_1",path:"/arcade/assets/stickers/husky.png"},{id:"panda_1",path:"/arcade/assets/stickers/panda.png"},{id:"tiger_1",path:"/arcade/assets/stickers/tiger.png"},{id:"frog_1",path:"/arcade/assets/stickers/frog.png"},{id:"rooster_1",path:"/arcade/assets/stickers/rooster.png"},{id:"crocodile_1",path:"/arcade/assets/stickers/crocodile.png"},{id:"police_1",path:"/arcade/assets/stickers/police.png"},{id:"barbie_1",path:"/arcade/assets/stickers/barbie.png"},{id:"grumble_1",path:"/arcade/assets/stickers/grumble.png"},{id:"jaina_1",path:"/arcade/assets/stickers/jaina.png"}];class S{constructor(e){t(this,"app"),t(this,"gameContainer"),t(this,"stickerMaker"),t(this,"removeTopBarHandler"),t(this,"gameDimensions"),t(this,"userState"),this.app=e,this.gameContainer=new i,this.gameDimensions=k(),this.stickerMaker=new g(this.app,this,this.gameContainer,this.gameDimensions.gameWidth,this.gameDimensions.gameHeight),this.app.stage.addChild(this.gameContainer),this.userState=this.loadUserState(),this.setupGlobalPointerEvents()}async init(){this.createBackground(),this.setupTopBarEvents(),this.showLevelMenu(),this.populateLevelMenuWithPlaceholders(),this.setupReturnButton(),this.setupClickOutsideHandler(),this.loadAssetsProgressively()}showLevelMenu(){this.gameContainer.visible=!1;const e=document.getElementById("levelMenu");e&&e.classList.remove("hidden")}hideLevelMenu(){this.gameContainer.visible=!0;const e=document.getElementById("levelMenu");e&&e.classList.add("hidden")}hideOtherDifficultyButtons(e){document.querySelectorAll(".level-card").forEach(t=>{t!==e&&t.classList.remove("show-buttons")})}toggleDifficultyButtons(e){const t=e.classList.contains("show-buttons");document.querySelectorAll(".level-card").forEach(e=>{e.classList.remove("show-buttons")}),t||e.classList.add("show-buttons")}setupClickOutsideHandler(){document.addEventListener("click",e=>{e.target.closest(".level-card")||document.querySelectorAll(".level-card").forEach(e=>{e.classList.remove("show-buttons")})})}populateLevelMenuWithPlaceholders(){const e=document.getElementById("levelGrid");e&&(e.innerHTML="",v.forEach(t=>{const i=this.userState.levelsCompleted.includes(t.id),r=document.createElement("div");r.className="level-card "+(i?"completed":""),r.dataset.levelId=t.id;const n=document.createElement("img");if(n.className="level-image",n.alt=`Level ${t.id}`,s.cache.has(t.path))n.src=t.path,n.style.opacity="1",r.appendChild(n);else{n.classList.add("loading");const e=document.createElement("div");e.className="level-placeholder",e.textContent="⏳",r.appendChild(e),r.appendChild(n)}this.createDifficultyButtons(r,t),e.appendChild(r)}))}async loadAssetsProgressively(){await s.load("/arcade/assets/stickers/star.png");for(const t of v)try{await s.load(t.path),this.updateLevelCard(t)}catch(e){this.updateLevelCardWithError(t)}}updateLevelCard(e){const t=document.querySelector(`[data-level-id="${e.id}"]`);if(!t)return;const i=t.querySelector(".level-image"),s=t.querySelector(".level-placeholder");i&&s&&(i.src=e.path,i.onload=()=>{i.classList.remove("loading"),i.style.opacity="1",s.style.opacity="0",s.style.display="none"})}updateLevelCardWithError(e){const t=document.querySelector(`[data-level-id="${e.id}"]`);if(!t)return;const i=t.querySelector(".level-placeholder");i&&(i.textContent="❌",i.style.color="#ff6b6b")}createDifficultyButtons(e,t){const i=document.createElement("div");i.className="difficulty-buttons";const s=document.createElement("button");s.className="difficulty-btn easy",s.textContent="3x3",s.addEventListener("click",e=>{e.stopPropagation(),this.startLevel(t,m.gideSizeSmall)});const r=document.createElement("button");r.className="difficulty-btn medium",r.textContent="5x5",r.addEventListener("click",e=>{e.stopPropagation(),this.startLevel(t,m.gideSizeMedium)});const n=document.createElement("button");n.className="difficulty-btn hard",n.textContent="7x7",n.addEventListener("click",e=>{e.stopPropagation(),this.startLevel(t,m.gideSizeLarge)}),i.appendChild(s),i.appendChild(r),i.appendChild(n),e.appendChild(i),e.addEventListener("mouseenter",()=>{this.hideOtherDifficultyButtons(e)}),e.addEventListener("click",t=>{t.target.classList.contains("difficulty-btn")||(this.toggleDifficultyButtons(e),setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"center"})},100))})}populateLevelMenu(){this.populateLevelMenuWithPlaceholders()}async startLevel(e,t){this.hideLevelMenu(),this.hideReturnButton(),this.stickerMaker.cleanup(),this.createBackground(),await this.stickerMaker.createSticker(e,t)}loadUserState(){const e=localStorage.getItem("userState");return e?JSON.parse(e):{levelsCompleted:[]}}setLevelCompleted(e){this.userState.levelsCompleted.includes(e)||(this.userState.levelsCompleted.push(e),this.saveUserState())}returnToLevelMenu(){this.stickerMaker.cleanup(),this.gameContainer.removeChildren(),this.hideReturnButton(),this.showLevelMenu(),this.populateLevelMenu()}setupReturnButton(){const e=document.getElementById("returnButton");e&&e.addEventListener("click",()=>{this.returnToLevelMenu()})}showReturnButton(){const e=document.getElementById("returnButton");e&&e.classList.remove("hidden")}hideReturnButton(){const e=document.getElementById("returnButton");e&&e.classList.add("hidden")}saveUserState(){localStorage.setItem("userState",JSON.stringify(this.userState))}createBackground(){const e=new o;e.beginFill(16777215),e.drawRect(0,0,this.gameDimensions.gameWidth,this.gameDimensions.gameHeight),e.endFill(),this.gameContainer.addChild(e)}setupTopBarEvents(){const e=e=>{"pause"===e.type?this.togglePause():"menu"===e.type&&(this.gameContainer.visible?this.returnToLevelMenu():this.returnToMainMenu())};document.addEventListener("pause",e),document.addEventListener("menu",e),this.removeTopBarHandler=()=>{document.removeEventListener("pause",e),document.removeEventListener("menu",e)}}update(e){}togglePause(){}destroy(){this.removeTopBarHandler&&this.removeTopBarHandler(),this.stickerMaker.cleanup(),this.app.stage.removeChild(this.gameContainer),this.gameContainer.destroy({children:!0})}returnToMainMenu(){window.location.href="/arcade/"}onResize(){this.gameDimensions=k(),this.app.renderer.resize(this.gameDimensions.gameWidth,this.gameDimensions.gameHeight),this.stickerMaker.gameWidth=this.gameDimensions.gameWidth,this.stickerMaker.gameHeight=this.gameDimensions.gameHeight,this.stickerMaker.clampChunksToScreen()}setupGlobalPointerEvents(){this.app.stage.eventMode="static",this.app.stage.on("pointermove",e=>{this.stickerMaker.onMove(e)}),this.app.stage.on("pointerup",()=>{this.stickerMaker.onUp()}),this.app.stage.on("pointerupoutside",()=>{this.stickerMaker.onUp()}),this.app.view.oncontextmenu=e=>e.preventDefault()}}window.isInit=!1,window.addEventListener("load",async function(){if(window.isInit)return;window.isInit=!0;const e=k(),t=new d({width:e.gameWidth,height:e.gameHeight,backgroundColor:16777215,antialias:!0,resolution:window.devicePixelRatio||1}),i=document.getElementById("gameContainer");i&&i.appendChild(t.view);const s=new S(t);await s.init(),t.ticker.add(e=>{s.update(e)}),window.addEventListener("resize",()=>{s.onResize()}),window.restartGame=()=>{},window.returnToMainMenu=()=>{s.returnToMainMenu()},window.resumeGame=()=>{},window.togglePause=()=>{s.togglePause()}});
