var t=Object.defineProperty,e=(e,i,s)=>((e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s)(e,"symbol"!=typeof i?i+"":i,s);import"./main-CbnGJIeQ.js";import{C as i,b as s,S as r,R as n,c as a,d as h,G as o,a as c,e as p,A as l}from"./HTMLText-jsq7dBye.js";class d{constructor(t,i,s){e(this,"sprite"),e(this,"id"),e(this,"originX"),e(this,"originY"),e(this,"dragOffset",{x:0,y:0}),e(this,"hole",null),e(this,"inPlay",!1),e(this,"stickerMaker"),e(this,"brightnessFilter"),this.sprite=t,this.id=i,this.originX=t.position.x,this.originY=t.position.y,this.stickerMaker=s,this.makeDraggable(),this.inPlay=!0,this.brightnessFilter=new p,this.sprite.filters=[this.brightnessFilter]}makeDraggable(){this.sprite.eventMode="static",this.sprite.cursor="pointer",this.sprite.on("pointerdown",t=>{if(!this.inPlay)return;const e=t.getLocalPosition(this.sprite.parent);this.dragOffset.x=e.x-this.sprite.position.x,this.dragOffset.y=e.y-this.sprite.position.y,this.sprite.parent.addChild(this.sprite);const i=new CustomEvent("startChunkDrag",{detail:{chunk:this,event:t}});document.dispatchEvent(i)})}checkSnapToHole(){Math.sqrt(Math.pow(this.sprite.position.x-this.originX,2)+Math.pow(this.sprite.position.y-this.originY,2))<m.snapThreshold/m.gideSize&&(this.sprite.position.x=this.originX,this.sprite.position.y=this.originY,this.correctlyPlaced())}onDrop(){this.sprite.position.x<0&&(this.sprite.position.x=0),this.sprite.position.x>this.stickerMaker.gameWidth-this.sprite.width&&(this.sprite.position.x=this.stickerMaker.gameWidth-this.sprite.width),this.sprite.position.y<0&&(this.sprite.position.y=0),this.sprite.position.y>this.stickerMaker.gameHeight-this.sprite.height&&(this.sprite.position.y=this.stickerMaker.gameHeight-this.sprite.height),this.checkSnapToHole()}correctlyPlaced(){performance.now(),this.sprite.alpha=1,this.inPlay=!1,this.sprite.cursor="default",this.sprite.parent.setChildIndex(this.sprite,0);let t=0;const e=i=>{t+=i;const s=Math.min(t/60,1);let r;if(s<.25){const t=s/.25;r=2+t*t*4}else if(s<.9){const t=(s-.25)/1;r=4-3*(1-(1-t)*(1-t))}else r=1;this.brightnessFilter.brightness(r,!1),s>=1&&(this.sprite.filters=[],this.stickerMaker.app.ticker.remove(e))};this.stickerMaker.app.ticker.add(e),this.stickerMaker.createSnapParticles(this.sprite.position.x+this.sprite.width/2,this.sprite.position.y+this.sprite.height/2),performance.now(),setTimeout(()=>{this.sprite.eventMode="none"},1e3)}clamp(){this.sprite.position.x<0&&(this.sprite.position.x=0),this.sprite.position.x>this.stickerMaker.gameWidth-this.sprite.width&&(this.sprite.position.x=this.stickerMaker.gameWidth-this.sprite.width),this.sprite.position.y<0&&(this.sprite.position.y=0),this.sprite.position.y>this.stickerMaker.gameHeight-this.sprite.height&&(this.sprite.position.y=this.stickerMaker.gameHeight-this.sprite.height)}}class u{constructor(t,i,s){e(this,"id"),e(this,"chunk"),e(this,"graphics"),this.id=i,this.chunk=s,this.graphics=t}}class g{constructor(t,s,r,n,a){e(this,"app"),e(this,"game"),e(this,"gameContainer"),e(this,"currentStickerSprite",null),e(this,"gameWidth"),e(this,"gameHeight"),e(this,"holeContainer"),e(this,"chunkContainer"),e(this,"chunks",{}),e(this,"holes",{}),e(this,"activeChunk",null),e(this,"currentLevel"),this.app=t,this.game=s,this.gameContainer=r,this.gameWidth=n,this.gameHeight=a,this.holeContainer=new i,this.chunkContainer=new i,this.setupStickerMakerEvents()}setupStickerMakerEvents(){document.addEventListener("startChunkDrag",t=>{const e=t,{chunk:i,event:s}=e.detail;this.handleStartDrag(i,s)})}handleStartDrag(t,e){this.activeChunk||(this.activeChunk=t)}async createSticker(t){this.currentLevel=t,performance.now();const e=await s.load(t.path);this.currentStickerSprite=new r(e);const i=.9*this.gameWidth,n=.9*this.gameHeight;if(this.currentStickerSprite.width>i||this.currentStickerSprite.height>n){const t=i/this.currentStickerSprite.width,e=n/this.currentStickerSprite.height,s=Math.min(t,e);this.currentStickerSprite.scale.set(s)}this.currentStickerSprite.anchor.set(.5,.5),this.currentStickerSprite.position.set(this.gameWidth/2,this.gameHeight/2),this.gameContainer.addChild(this.currentStickerSprite),this.gameContainer.addChild(this.holeContainer),this.gameContainer.addChild(this.chunkContainer),this.cutIntoTrianglesAndSquares(e),performance.now(),this.shuffleChunks()}cutIntoTrianglesAndSquares(t){const e=n.create({width:t.width,height:t.height}),i=new r(t);this.app.renderer.render(i,{renderTexture:e});const s=this.app.renderer.extract.canvas(e),a=s.getContext("2d").getImageData(0,0,s.width,s.height).data,h=m.gideSize,o=t.width/h,c=t.height/h;for(let r=0;r<h;r++)for(let e=0;e<h;e++){const i=Math.round(e*o),n=Math.round(r*c),h=Math.round((e+1)*o),p=Math.round((r+1)*c);Math.random()>.5?this.createDraggableSquareFromTexture(i,n,h,p,t,a,s.width,s.height):Math.random()>.5?(this.createDraggableTriangleFromTexture(i,n,h,n,i,p,t,a,s.width,s.height),this.createDraggableTriangleFromTexture(h,n,h,p,i,p,t,a,s.width,s.height)):(this.createDraggableTriangleFromTexture(i,n,h,n,h,p,t,a,s.width,s.height),this.createDraggableTriangleFromTexture(i,n,h,p,i,p,t,a,s.width,s.height))}e.destroy(!0)}isPointInTriangleSimple(t,e,i,s,r,n,a,h){const o=(t-r)*(s-n)-(i-r)*(e-n),c=(t-a)*(n-h)-(r-a)*(e-h),p=(t-i)*(h-s)-(a-i)*(e-s);return!((o<0||c<0||p<0)&&(o>0||c>0||p>0))}createDraggableSquareFromTexture(t,e,i,s,n,o,c,p){if(!this.currentStickerSprite)throw new Error("Sticker sprite not found");let l=0;const u=(i-t)*(s-e);for(let r=e;r<s;r++)for(let e=t;e<i;e++)o[4*(r*c+e)+3]>128&&l++;if(l/u<m.visiblePercentage)return;const g=new a(t,e,i-t,s-e),k=new h(n.baseTexture,g),S=new r(k),v=this.currentStickerSprite.position.x-this.currentStickerSprite.width/2,C=this.currentStickerSprite.position.y-this.currentStickerSprite.height/2;S.position.set(v+t*this.currentStickerSprite.scale.x,C+e*this.currentStickerSprite.scale.y),S.scale.set(this.currentStickerSprite.scale.x,this.currentStickerSprite.scale.y);const w=new d(S,`chunk_${Object.keys(this.chunks).length+1}`,this);this.chunks[w.id]=w,this.chunkContainer.addChild(S),this.paintHoleFromSprite(w,i-t,s-e)}createDraggableTriangleFromTexture(t,e,i,s,r,n,c,p,l,u){if(!this.currentStickerSprite)throw new Error("Sticker sprite not found.");const g=Math.min(t,i,r),k=Math.min(e,s,n),S=Math.max(t,i,r),v=Math.max(e,s,n);let C=0,w=0;for(let a=k;a<=v;a++)for(let h=g;h<=S;h++)this.isPointInTriangleSimple(h,a,t,e,i,s,r,n)&&(w++,p[4*(a*l+h)+3]>128&&C++);if(0===w)return;if(C/w<m.visiblePercentage)return;const M=Math.min(t,i,r),f=Math.min(e,s,n),y=Math.max(t,i,r),x=Math.max(e,s,n),T=new a(M,f,y-M,x-f),b=new h(c.baseTexture,T),L=new o;L.beginTextureFill({texture:b}),L.moveTo(t-M,e-f),L.lineTo(i-M,s-f),L.lineTo(r-M,n-f),L.lineTo(t-M,e-f),L.endFill();const H=this.currentStickerSprite.position.x-this.currentStickerSprite.width/2,D=this.currentStickerSprite.position.y-this.currentStickerSprite.height/2;L.position.set(H+M*this.currentStickerSprite.scale.x,D+f*this.currentStickerSprite.scale.y),L.scale.set(this.currentStickerSprite.scale.x,this.currentStickerSprite.scale.y);const E=new d(L,`chunk_${Object.keys(this.chunks).length+1}`,this);this.chunks[E.id]=E,this.chunkContainer.addChild(L),this.paintHoleFromSprite(E,y-M,x-f)}paintHoleFromSprite(t,e,i){if(!this.currentStickerSprite)throw new Error("Sticker sprite not found");let s;s=t.sprite instanceof r?new r(t.sprite.texture):t.sprite.clone(),s.position.set(0,0),s.scale.set(1,1);const a=n.create({width:e,height:i});this.app.renderer.render(s,{renderTexture:a});const h=this.app.renderer.extract.canvas(a).getContext("2d").getImageData(0,0,e,i).data,c=Math.floor(156*Math.random())+50<<16|Math.floor(156*Math.random())+50<<8|Math.floor(156*Math.random())+50,p=new o;for(let r=0;r<i;r++)for(let i=0;i<e;i++)h[4*(r*e+i)+3]>200&&(p.beginFill(c),p.drawRect(t.sprite.position.x+i*t.sprite.scale.x,t.sprite.position.y+r*t.sprite.scale.y,1,1),p.endFill());this.holeContainer.addChild(p);const l=new u(p,t.id,t);this.holes[t.id]=l,t.hole=l,a.destroy(!0)}shuffleChunks(){if(!this.currentStickerSprite)return;const t=.1*this.gameWidth;for(const e of Object.values(this.chunks)){const i=Math.random()>.5;e.sprite.position.x=i?Math.random()*t:this.gameWidth-t+Math.random()*t,e.sprite.position.y=Math.random()*this.gameHeight,e.clamp()}}clampChunksToScreen(){for(const t of Object.values(this.chunks))t.clamp()}onMove(t){if(this.activeChunk){const e=t.getLocalPosition(this.activeChunk.sprite.parent);this.activeChunk.sprite.position.x=e.x-this.activeChunk.dragOffset.x,this.activeChunk.sprite.position.y=e.y-this.activeChunk.dragOffset.y}}onUp(){this.activeChunk&&(this.activeChunk.onDrop(),this.activeChunk=null,this.checkIfAllChunksArePlaced()&&(this.celebrate(),this.game.setLevelCompleted(this.currentLevel.id)))}createSnapParticles(t,e){for(let i=0;i<30;i++){const s=new o,r=4*Math.random()+2;s.beginFill(16777215),s.drawCircle(0,0,r),s.endFill(),s.position.set(t,e);const n=2*Math.PI*i/30+.8*(Math.random()-.5),a=3*Math.random()+4,h=Math.cos(n)*a,c=Math.sin(n)*a;this.gameContainer.addChild(s);let p=30;const l=.3;let d=h,u=c;const g=t=>{p-=t,u+=l*t,s.position.x+=d*t,s.position.y+=u*t,s.alpha=p/30;const e=p/30+.1;s.scale.set(e),p<=0&&(this.app.ticker.remove(g),this.gameContainer.removeChild(s),s.destroy())};this.app.ticker.add(g)}}checkIfAllChunksArePlaced(){return Object.values(this.chunks).every(t=>!1===t.inPlay)}cleanup(){for(const t of Object.values(this.chunks))t.sprite.parent&&t.sprite.parent.removeChild(t.sprite),t.sprite.destroy({children:!0});for(const t of Object.values(this.holes))t.graphics.parent&&t.graphics.parent.removeChild(t.graphics),t.graphics.destroy();this.currentStickerSprite&&(this.currentStickerSprite.parent&&this.currentStickerSprite.parent.removeChild(this.currentStickerSprite),this.currentStickerSprite.destroy(),this.currentStickerSprite=null),this.holeContainer.removeChildren(),this.chunkContainer.removeChildren(),this.chunks={},this.holes={},this.activeChunk=null,this.holeContainer.parent&&this.holeContainer.parent.removeChild(this.holeContainer),this.chunkContainer.parent&&this.chunkContainer.parent.removeChild(this.chunkContainer)}celebrate(){const t=s.get("/arcade/assets/stickers/star.png"),e=this.gameWidth/2,i=this.gameHeight/2;for(let s=0;s<20;s++){const n=new r(t);n.anchor.set(.5,.5),n.position.set(e,i);const a=.8*Math.random()+.4;n.scale.set(a),this.gameContainer.addChild(n);const h=2*Math.PI*s/20+.5*(Math.random()-.5),o=4*Math.random()+3,c=Math.cos(h)*o,p=Math.sin(h)*o;let l=120;const d=.05;let u=c,g=p;const m=t=>{l-=t,g+=d*t,n.position.x+=u*t,n.position.y+=g*t;const e=l/120;n.alpha=e,n.scale.set(a*e),n.rotation+=.1*t,l<=0&&(this.app.ticker.remove(m),this.gameContainer.removeChild(n),n.destroy())};this.app.ticker.add(m)}setTimeout(()=>{const t=new c("⭐ Puzzle Completed! ⭐");t.style.fontSize=48,t.style.fill="#FFD700",t.style.stroke="#000000",t.style.strokeThickness=5,t.style.fontFamily="Arial, sans-serif",t.style.fontWeight="bold",t.anchor.set(.5,.5),t.position.set(this.gameWidth/2,this.gameHeight-50),this.gameContainer.addChild(t),t.alpha=0,t.scale.set(.5);let e=0;const i=s=>{e+=s;const r=Math.min(e/30,1),n=1-(1-r)*(1-r);t.alpha=n,t.scale.set(.5+.5*n),r>=1&&this.app.ticker.remove(i)};this.app.ticker.add(i),setTimeout(()=>{t.parent&&(this.gameContainer.removeChild(t),t.destroy(),this.game.showReturnButton())},3e3)},500)}}const m={gideSize:5,snapThreshold:100,visiblePercentage:.1},k=()=>({gameWidth:window.innerWidth,gameHeight:window.innerHeight-48,topBarHeight:48,scale:1}),S=[{id:"lion_1",path:"/arcade/assets/stickers/lion.png"},{id:"elephant_1",path:"/arcade/assets/stickers/elephant.png"},{id:"chimp_1",path:"/arcade/assets/stickers/chimp.png"},{id:"husky_1",path:"/arcade/assets/stickers/husky.png"},{id:"panda_1",path:"/arcade/assets/stickers/panda.png"},{id:"tiger_1",path:"/arcade/assets/stickers/tiger.png"},{id:"skibidi_1",path:"/arcade/assets/stickers/skibidi.png"}];class v{constructor(t){e(this,"app"),e(this,"gameContainer"),e(this,"stickerMaker"),e(this,"removeTopBarHandler"),e(this,"gameDimensions"),e(this,"userState"),this.app=t,this.gameContainer=new i,this.gameDimensions=k(),this.stickerMaker=new g(this.app,this,this.gameContainer,this.gameDimensions.gameWidth,this.gameDimensions.gameHeight),this.app.stage.addChild(this.gameContainer),this.userState=this.loadUserState(),this.setupGlobalPointerEvents()}async init(){this.createBackground(),this.setupTopBarEvents(),await s.load("/arcade/assets/stickers/star.png");for(const t of S)await s.load(t.path);this.showLevelMenu(),this.populateLevelMenu(),this.setupReturnButton()}showLevelMenu(){this.gameContainer.visible=!1;const t=document.getElementById("levelMenu");t&&t.classList.remove("hidden")}hideLevelMenu(){this.gameContainer.visible=!0;const t=document.getElementById("levelMenu");t&&t.classList.add("hidden")}populateLevelMenu(){const t=document.getElementById("levelGrid");t&&(t.innerHTML="",S.forEach(e=>{const i=this.userState.levelsCompleted.includes(e.id),s=document.createElement("div");s.className="level-card "+(i?"completed":""),s.dataset.levelId=e.id;const r=document.createElement("img");r.className="level-image",r.src=e.path,r.alt=`Level ${e.id}`,s.appendChild(r),s.addEventListener("click",()=>{this.startLevel(e)}),t.appendChild(s)}))}async startLevel(t){this.hideLevelMenu(),this.hideReturnButton(),this.stickerMaker.cleanup(),this.createBackground(),await this.stickerMaker.createSticker(t)}loadUserState(){const t=localStorage.getItem("userState");return t?JSON.parse(t):{levelsCompleted:[]}}setLevelCompleted(t){this.userState.levelsCompleted.includes(t)||(this.userState.levelsCompleted.push(t),this.saveUserState())}returnToLevelMenu(){this.stickerMaker.cleanup(),this.gameContainer.removeChildren(),this.hideReturnButton(),this.showLevelMenu(),this.populateLevelMenu()}setupReturnButton(){const t=document.getElementById("returnButton");t&&t.addEventListener("click",()=>{this.returnToLevelMenu()})}showReturnButton(){const t=document.getElementById("returnButton");t&&t.classList.remove("hidden")}hideReturnButton(){const t=document.getElementById("returnButton");t&&t.classList.add("hidden")}saveUserState(){localStorage.setItem("userState",JSON.stringify(this.userState))}createBackground(){const t=new o;t.beginFill(16777215),t.drawRect(0,0,this.gameDimensions.gameWidth,this.gameDimensions.gameHeight),t.endFill(),this.gameContainer.addChild(t)}setupTopBarEvents(){const t=t=>{"pause"===t.type?this.togglePause():"menu"===t.type&&(this.gameContainer.visible?this.returnToLevelMenu():this.returnToMainMenu())};document.addEventListener("pause",t),document.addEventListener("menu",t),this.removeTopBarHandler=()=>{document.removeEventListener("pause",t),document.removeEventListener("menu",t)}}update(t){}togglePause(){}destroy(){this.removeTopBarHandler&&this.removeTopBarHandler(),this.stickerMaker.cleanup(),this.app.stage.removeChild(this.gameContainer),this.gameContainer.destroy({children:!0})}returnToMainMenu(){window.location.href="/arcade/"}onResize(){this.gameDimensions=k(),this.app.renderer.resize(this.gameDimensions.gameWidth,this.gameDimensions.gameHeight),this.stickerMaker.gameWidth=this.gameDimensions.gameWidth,this.stickerMaker.gameHeight=this.gameDimensions.gameHeight,this.stickerMaker.clampChunksToScreen()}setupGlobalPointerEvents(){this.app.stage.eventMode="static",this.app.stage.on("pointermove",t=>{this.stickerMaker.onMove(t)}),this.app.stage.on("pointerup",()=>{this.stickerMaker.onUp()}),this.app.stage.on("pointerupoutside",()=>{this.stickerMaker.onUp()}),this.app.view.oncontextmenu=t=>t.preventDefault()}}window.isInit=!1,window.addEventListener("load",async function(){if(window.isInit)return;window.isInit=!0;const t=k(),e=new l({width:t.gameWidth,height:t.gameHeight,backgroundColor:16777215,antialias:!0,resolution:window.devicePixelRatio||1}),i=document.getElementById("gameContainer");i&&i.appendChild(e.view);const s=new v(e);await s.init(),e.ticker.add(t=>{s.update(t)}),window.addEventListener("resize",()=>{s.onResize()}),window.restartGame=()=>{},window.returnToMainMenu=()=>{s.returnToMainMenu()},window.resumeGame=()=>{},window.togglePause=()=>{s.togglePause()}});
