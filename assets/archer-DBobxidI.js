var t=Object.defineProperty,i=(i,e,s)=>((i,e,s)=>e in i?t(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s)(i,"symbol"!=typeof e?e+"":e,s);import"./main-CPvXibab.js";import{A as e,C as s,G as r,P as n}from"./HTMLText-f6zgcEQF.js";const h=1920,o=1080,a=45,c=()=>{const t=window.innerWidth,i=window.innerHeight-120,e=t/h,s=i/o,r=Math.min(e,s);return{gameWidth:h,gameHeight:o,scale:r}};class l{constructor(t,e,n){i(this,"container"),i(this,"graphics"),i(this,"x"),i(this,"y"),i(this,"angle"),this.x=t,this.y=e,this.angle=n,this.container=new s,this.container.position.set(t,e),this.container.rotation=n,this.graphics=new r,this.graphics.lineStyle(4,16747520),this.graphics.moveTo(0,0),this.graphics.lineTo(50,0),this.graphics.beginFill(16747520),this.graphics.moveTo(50,-4),this.graphics.lineTo(50,4),this.graphics.lineTo(58,0),this.graphics.endFill(),this.graphics.beginFill(16747520),this.graphics.drawRect(-3,-2,6,4),this.graphics.endFill(),this.container.addChild(this.graphics)}destroy(){this.container.destroy()}}class d{constructor(t,e,n,h){i(this,"container"),i(this,"graphics"),i(this,"width"),i(this,"height"),this.container=new s,this.container.position.set(t,e),this.width=n,this.height=h,this.graphics=new r,this.graphics.beginFill(9127187),this.graphics.lineStyle(2,6636321),this.graphics.drawRect(0,0,n,h),this.graphics.endFill(),this.graphics.lineStyle(1,10506797);for(let i=0;i<h;i+=8)this.graphics.moveTo(0,i),this.graphics.lineTo(n,i);this.container.addChild(this.graphics)}destroy(){this.container.destroy()}checkCollision(t){const i=this.container.x,e=this.container.x+this.width,s=this.container.y,r=this.container.y+this.height;return t.x>=i&&t.x<=e&&t.y>=s&&t.y<=r}}class g{constructor(t,e,n,h,o){i(this,"x"),i(this,"y"),i(this,"vx"),i(this,"vy"),i(this,"active",!0),i(this,"container"),i(this,"graphics"),i(this,"length",50),i(this,"game"),this.x=t,this.y=e,this.vx=Math.cos(n)*h,this.vy=Math.sin(n)*h,this.game=o,this.container=new s,this.container.position.set(t,e),this.container.rotation=n,this.graphics=new r,this.graphics.lineStyle(4,16747520),this.graphics.moveTo(0,0),this.graphics.lineTo(this.length,0),this.graphics.beginFill(16747520),this.graphics.moveTo(this.length,-4),this.graphics.lineTo(this.length,4),this.graphics.lineTo(this.length+8,0),this.graphics.endFill(),this.graphics.beginFill(16747520),this.graphics.drawRect(-3,-2,6,4),this.graphics.endFill(),this.container.addChild(this.graphics)}update(){if(!this.active)return!1;this.vy+=.6,this.vx*=.999,this.x+=this.vx,this.y+=this.vy,this.container.position.set(this.x,this.y);const t=Math.atan2(this.vy,this.vx);this.container.rotation=t;for(let i=this.game.targets.length-1;i>=0;i--){const t=this.game.targets[i];if(t.checkCollision(this)){const i=this.game.calculateCollisionPoint(this,t);return this.game.spawnStuckArrow(i.x,i.y,this.container.rotation),this.destroy(),!1}}for(let i=this.game.boxes.length-1;i>=0;i--)if(this.game.boxes[i].checkCollision(this))return this.game.spawnStuckArrow(this.x,this.y,this.container.rotation),this.destroy(),!1;return this.y>=1030?(this.game.spawnStuckArrow(this.x,1030,this.container.rotation),this.destroy(),!1):!(this.x>h||this.x<0)||(this.active=!1,this.container.destroy(),!1)}destroy(){this.active=!1,this.container.destroy()}}class p{constructor(t,e,n=30,h){i(this,"x"),i(this,"y"),i(this,"radius"),i(this,"container"),i(this,"graphics"),i(this,"platform"),this.x=t,this.y=e,this.radius=n,this.platform=h,this.container=new s,this.container.position.set(t,e),this.graphics=new r,this.graphics.beginFill(16729156),this.graphics.lineStyle(3,16777215),this.graphics.drawCircle(0,0,n),this.graphics.endFill(),this.graphics.beginFill(16776960),this.graphics.lineStyle(2,16777215),this.graphics.drawCircle(0,0,.6*n),this.graphics.endFill(),this.graphics.beginFill(16711680),this.graphics.lineStyle(2,16777215),this.graphics.drawCircle(0,0,.3*n),this.graphics.endFill(),this.container.addChild(this.graphics)}checkCollision(t){const i=t.x-this.x,e=t.y-this.y;return Math.sqrt(i*i+e*e)<=this.radius}destroy(){this.container.destroy(),this.platform&&this.platform.destroy()}}class w{constructor(t){i(this,"container"),i(this,"bodyContainer"),i(this,"arrowContainer"),i(this,"circle"),i(this,"bowArrow",null),i(this,"bowHand"),i(this,"game"),i(this,"bowRadius",35),this.game=t,this.container=new s,this.container.position.set(200,940),this.bodyContainer=new s;const e=new r;e.beginFill(8421504),e.drawRect(-30,20,18,32),e.endFill(),e.rotation=-.1;const n=new r;n.beginFill(16747520),n.drawRect(-30,5,4,12),n.endFill(),n.rotation=-.1,e.addChild(n);const h=new r;h.beginFill(16747520),h.drawRect(-25,5,4,12),h.endFill(),h.rotation=-.1,e.addChild(h);const o=new r;o.beginFill(16747520),o.drawRect(-20,5,4,12),o.endFill(),o.rotation=-.1,e.addChild(o),this.circle=new r,this.circle.beginFill(0),this.circle.drawCircle(0,0,20),this.circle.endFill();const a=new r;a.lineStyle(8,0),a.moveTo(0,20),a.lineTo(0,55),this.bowHand=new r,this.bowHand.lineStyle(6,0),this.bowHand.moveTo(0,35),this.bowHand.lineTo(35,0);const c=new r;c.lineStyle(8,0),c.moveTo(0,50),c.lineTo(-10,90);const l=new r;l.lineStyle(8,0),l.moveTo(0,50),l.lineTo(10,90),this.arrowContainer=new s,this.arrowContainer.y=15;const d=new r;d.lineStyle(6,9127187),d.arc(0,0,this.bowRadius,-Math.PI/2,Math.PI/2,!1),this.createNewBowArrow(),this.bodyContainer.addChild(e),this.bodyContainer.addChild(this.circle),this.bodyContainer.addChild(a),this.bodyContainer.addChild(this.bowHand),this.bodyContainer.addChild(c),this.bodyContainer.addChild(l),this.container.addChild(this.bodyContainer),this.arrowContainer.addChild(d),this.container.addChild(this.arrowContainer)}updateAngle(t){this.arrowContainer.rotation=t,this.updateHandPosition(t)}updateHandPosition(t){this.bowHand.clear(),this.bowHand.lineStyle(6,0),this.bowHand.moveTo(0,35);const i=Math.cos(t)*this.bowRadius,e=Math.sin(t)*this.bowRadius+15;this.bowHand.lineTo(i,e)}updateArrowPosition(t,i){if(!this.bowArrow)return;const e=t/i*20;this.bowArrow.container.x=-e,this.bowArrow.container.y=0}getBowArrow(){return this.bowArrow}clearBowArrow(){this.bowArrow=null}createNewBowArrow(){this.bowArrow=new g(0,0,0,0,this.game),this.bowArrow.active=!1,this.bowArrow.container.x=10,this.arrowContainer.addChild(this.bowArrow.container),this.updateArrowPosition(0,a)}destroy(){this.container.destroy()}}class u{constructor(t){i(this,"app"),i(this,"gameContainer"),i(this,"simpleArcher"),i(this,"projectiles",[]),i(this,"targets",[]),i(this,"boxes",[]),i(this,"stuckArrows",[]),i(this,"score",0),i(this,"highScore",0),i(this,"targetsHit",0),i(this,"currentRound",1),i(this,"isGameOver",!1),i(this,"isPaused",!1),i(this,"isWaitingToStart",!1),i(this,"isAiming",!1),i(this,"currentAngle",Math.PI/4),i(this,"currentPower",0),i(this,"powerCharging",!1),i(this,"isDragging",!1),i(this,"dragStartX",0),i(this,"dragStartY",0),i(this,"removeInputHandler"),i(this,"removeTopBarHandler"),i(this,"powerMeter"),i(this,"powerFill"),i(this,"angleIndicator"),i(this,"trajectoryLine"),i(this,"arrowsRemaining",10),i(this,"deltaAccumulator",0),i(this,"UPDATE_RATE",1/60),this.app=t,this.gameContainer=new s,this.app.stage.addChild(this.gameContainer),this.highScore=parseInt(localStorage.getItem("archerHighScore")||"0"),this.simpleArcher=new w(this),this.app.stage.addChild(this.simpleArcher.container),this.updateUI()}async init(){this.createUI(),this.createGround(),this.setupInput(),this.setupTopBarEvents(),this.updateUI(),this.spawnTarget()}createUI(){var t,i;this.powerMeter=document.createElement("div"),this.powerMeter.className="power-meter",this.powerFill=document.createElement("div"),this.powerFill.className="power-fill",this.powerMeter.appendChild(this.powerFill),this.angleIndicator=document.createElement("div"),this.angleIndicator.className="angle-indicator",this.angleIndicator.textContent="Angle: 45Â°",null==(t=document.getElementById("gameContainer"))||t.appendChild(this.powerMeter),null==(i=document.getElementById("gameContainer"))||i.appendChild(this.angleIndicator)}createGround(){const t=new r;t.beginFill(9419919),t.lineStyle(2,5597999),t.drawRect(0,1030,h,50),t.endFill(),t.lineStyle(1,5597999);for(let i=0;i<h;i+=20)t.moveTo(i,1030),t.lineTo(i+10,1020);this.app.stage.addChild(t)}setupTopBarEvents(){const t=t=>{"pause"===t.type?this.togglePause():"menu"===t.type&&this.returnToMainMenu()};document.addEventListener("pause",t),document.addEventListener("menu",t),this.removeTopBarHandler=()=>{document.removeEventListener("pause",t),document.removeEventListener("menu",t)}}setupInput(){this.app.stage.interactive=!0,this.app.stage.hitArea=this.app.screen,this.app.stage.on("pointermove",this.onPointerMove,this),this.app.stage.on("pointerdown",this.onPointerDown,this),this.app.stage.on("pointerup",this.onPointerUp,this),this.app.stage.on("pointerupoutside",this.onPointerUp,this),this.removeInputHandler=()=>{this.app.stage.off("pointermove",this.onPointerMove,this),this.app.stage.off("pointerdown",this.onPointerDown,this),this.app.stage.off("pointerup",this.onPointerUp,this),this.app.stage.off("pointerupoutside",this.onPointerUp,this)}}onPointerMove(t){if(!(this.isGameOver||this.isPaused||this.isWaitingToStart)&&(this.updateAim(t.global.x,t.global.y),this.isDragging)){const i=this.simpleArcher.container.x,e=this.simpleArcher.container.y,s=Math.sqrt(Math.pow(this.dragStartX-i,2)+Math.pow(this.dragStartY-e,2)),r=Math.sqrt(Math.pow(t.global.x-i,2)+Math.pow(t.global.y-e,2));if(Math.sqrt(Math.pow(t.global.x-this.dragStartX,2)+Math.pow(t.global.y-this.dragStartY,2))>5){const t=s-r;if(t>0?(this.powerCharging=!0,this.currentPower=Math.min(a,2+.05*t)):(this.powerCharging=!1,this.currentPower=Math.max(2,2+.05*t)),this.powerFill){const t=this.currentPower/a*100;this.powerFill.style.width=t+"%"}this.simpleArcher.updateArrowPosition(this.currentPower,a),this.updateTrajectoryLine()}}}onPointerDown(t){if(!(this.isGameOver||this.isPaused||this.isWaitingToStart)){if(this.isDragging=!0,this.dragStartX=t.global.x,this.dragStartY=t.global.y,this.isAiming=!0,this.powerCharging=!1,this.currentPower=2,this.powerFill){const t=this.currentPower/a*100;this.powerFill.style.width=t+"%"}this.simpleArcher.updateArrowPosition(this.currentPower,a)}}onPointerUp(t){this.isGameOver||this.isPaused||this.isWaitingToStart||(this.isDragging&&this.powerCharging&&this.shoot(),this.resetAimState())}updateAim(t,i){const e=t-this.simpleArcher.container.x,s=i-this.simpleArcher.container.y;this.currentAngle=Math.atan2(s,e),this.simpleArcher.updateAngle(this.currentAngle),this.angleIndicator&&(this.angleIndicator.textContent=`Angle: ${Math.round(180*this.currentAngle/Math.PI)}Â°`)}updateTrajectoryLine(){if(this.trajectoryLine&&(this.trajectoryLine.destroy(),this.trajectoryLine=void 0),!this.powerCharging||this.currentPower<2)return;this.trajectoryLine=new r;const t=this.simpleArcher.arrowContainer,i=this.simpleArcher.getBowArrow();if(!i)return;const e=i.container.x,s=i.container.y,o=t.toGlobal(new n(e,s)),a=Math.cos(this.currentAngle)*this.currentPower,c=Math.sin(this.currentAngle)*this.currentPower;let l=o.x,d=o.y,g=a,p=c;const w=[];w.push({x:l,y:d,skip:!1});let u=0,m=0;for(;m<1600;){if(p+=.6,g*=.999,l+=g,d+=p,m+=Math.sqrt(g*g+p*p),u+=Math.sqrt(g*g+p*p),u>=30&&(w.push({x:l,y:d,skip:m<80}),u=0),d>=1030){w.push({x:l,y:1030,skip:m<80});break}if(l>h||l<0)break}if(w.length>1){const t=w.length;for(let i=0;i<t-1;i++){const e=.4*(1-i/(t-1)*.9);this.trajectoryLine.lineStyle(4,"red",e),w[i].skip||(this.trajectoryLine.moveTo(w[i].x,w[i].y),this.trajectoryLine.lineTo(w[i+1].x,w[i+1].y))}}this.app.stage.addChild(this.trajectoryLine)}shoot(){if(!this.isAiming||!this.powerCharging)return;if(this.arrowsRemaining<=0)return;const t=this.simpleArcher.getBowArrow();if(!t)return;this.isAiming=!1,this.powerCharging=!1,this.arrowsRemaining--,this.simpleArcher.arrowContainer.removeChild(t.container);const i=this.simpleArcher.arrowContainer,e=t.container.x,s=t.container.y,r=i.toGlobal(new n(e,s));t.x=r.x,t.y=r.y,t.vx=Math.cos(this.currentAngle)*this.currentPower,t.vy=Math.sin(this.currentAngle)*this.currentPower,t.active=!0,t.container.position.set(t.x,t.y),t.container.rotation=this.currentAngle,this.projectiles.push(t),this.app.stage.addChild(t.container),this.simpleArcher.clearBowArrow(),this.simpleArcher.createNewBowArrow(),this.resetAimState(),this.updateUI()}update(t){this.isGameOver||this.isPaused||this.isWaitingToStart||(this.deltaAccumulator+=t,this.deltaAccumulator>=this.UPDATE_RATE&&(this.deltaAccumulator-=this.UPDATE_RATE,this.projectiles=this.projectiles.filter(t=>t.update()),this.arrowsRemaining<=0&&0===this.projectiles.length&&this.gameOver()))}spawnStuckArrow(t,i,e){const s=new l(t,i,e);this.stuckArrows.push(s),this.app.stage.addChild(s.container)}spawnTarget(){let t,i,e;this.targets.forEach(t=>t.destroy()),this.targets=[],this.boxes.forEach(t=>t.destroy()),this.boxes=[];const s=100*Math.random()+50,r=250*Math.random()+50,n=Math.random()*(760-s)+1060,h=1030-r;e=new d(n,h,s,r),this.app.stage.addChild(e.container),this.boxes.push(e),t=n+s/2,i=h-50;const o=new p(t,i,50,e);this.app.stage.addChild(o.container),this.targets.push(o)}gameOver(){this.isGameOver=!0,this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("archerHighScore",this.highScore.toString())),this.showGameOver()}showGameOver(){const t=document.getElementById("gameOver"),i=document.getElementById("finalScore"),e=document.getElementById("finalTargets"),s=document.getElementById("finalRounds");t&&i&&e&&s&&(i.textContent=this.score.toString(),e.textContent=this.targetsHit.toString(),s.textContent=(this.currentRound-1).toString(),t.style.display="block")}updateUI(){const t=document.getElementById("arrows");t&&(t.textContent=this.arrowsRemaining.toString())}togglePause(){this.isPaused=!this.isPaused,this.isPaused?this.showPauseMenu():this.hidePauseMenu()}showPauseMenu(){const t=document.getElementById("pauseMenu");t&&(t.style.display="block")}hidePauseMenu(){const t=document.getElementById("pauseMenu");t&&(t.style.display="none")}restart(){this.projectiles.forEach(t=>t.destroy()),this.targets.forEach(t=>t.destroy()),this.boxes.forEach(t=>t.destroy()),this.stuckArrows.forEach(t=>t.destroy()),this.projectiles=[],this.targets=[],this.boxes=[],this.stuckArrows=[],this.isGameOver=!1,this.isPaused=!1,this.isWaitingToStart=!1,this.arrowsRemaining=10,this.resetAimState(),this.simpleArcher.updateAngle(this.currentAngle),this.updateUI();const t=document.getElementById("gameOver"),i=document.getElementById("pauseMenu");t&&(t.style.display="none"),i&&(i.style.display="none"),this.spawnTarget()}resume(){this.isPaused=!1,this.hidePauseMenu()}destroy(){this.removeInputHandler&&this.removeInputHandler(),this.removeTopBarHandler&&this.removeTopBarHandler(),this.projectiles.forEach(t=>t.destroy()),this.targets.forEach(t=>t.destroy()),this.boxes.forEach(t=>t.destroy()),this.stuckArrows.forEach(t=>t.destroy()),this.trajectoryLine&&this.trajectoryLine.destroy(),this.simpleArcher.destroy(),this.app.stage.removeChild(this.gameContainer)}returnToMainMenu(){window.location.href="/arcade/"}startGame(){}calculateCollisionPoint(t,i){const e=t.x-t.vx,s=t.y-t.vy,r=i.x,n=i.y,h=i.radius,o=t.x-e,a=t.y-s,c=e-r,l=s-n,d=o*o+a*a,g=2*(c*o+l*a),p=g*g-4*d*(c*c+l*l-h*h);if(p<0)return{x:t.x,y:t.y};const w=(-g-Math.sqrt(p))/(2*d),u=Math.max(0,Math.min(1,w));return{x:e+o*u,y:s+a*u}}resetAimState(){this.isAiming=!1,this.powerCharging=!1,this.isDragging=!1,this.currentPower=0,this.simpleArcher.updateArrowPosition(0,a),this.powerFill&&(this.powerFill.style.width="0%"),this.angleIndicator&&(this.angleIndicator.textContent="Angle: 45Â°"),this.trajectoryLine&&(this.trajectoryLine.destroy(),this.trajectoryLine=void 0)}}let m=null,y=null;function A(){if(!y)return;const t=c(),i=y.view;i.style.width=h*t.scale+"px",i.style.height=o*t.scale+"px"}window.restartGame=()=>{m&&m.restart()},window.returnToMainMenu=()=>{m&&m.returnToMainMenu()},window.resumeGame=()=>{m&&m.resume()},window.togglePause=()=>{m&&m.togglePause()},window.addEventListener("load",async function(){const t=c();y=new e({width:h,height:o,backgroundColor:8900331,antialias:!0,resolution:window.devicePixelRatio||1});const i=document.getElementById("gameContainer");if(i){const e=y.view;e.style.width=h*t.scale+"px",e.style.height=o*t.scale+"px",e.style.maxWidth="100%",e.style.maxHeight="100%",e.style.objectFit="contain",i.appendChild(e)}m=new u(y),await m.init(),y.ticker.add(t=>{m&&m.update(t)}),window.addEventListener("resize",A)});
