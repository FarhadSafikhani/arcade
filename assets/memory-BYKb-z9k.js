var t=Object.defineProperty,i=(i,e,s)=>((i,e,s)=>e in i?t(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s)(i,"symbol"!=typeof e?e+"":e,s);import"./modulepreload-polyfill-YP0FEG5d.js";import"./game-top-bar-CMqa59EH.js";import{C as e,G as s,T as a,a as n,A as h}from"./HTMLText-C0YAAiNK.js";class d{constructor(t,s,a,n){i(this,"container"),i(this,"emoji"),i(this,"id"),i(this,"isFlipped",!1),i(this,"isMatched",!1),i(this,"background"),i(this,"emojiText"),i(this,"width"),i(this,"height"),i(this,"isAnimating",!1),this.width=t,this.height=s,this.emoji=a,this.id=n,this.container=new e,this.container.eventMode="static",this.container.cursor="pointer",this.container.pivot.set(t/2,s/2),this.createCard(),this.setupInteraction()}createCard(){this.background=new s,this.background.beginFill(3447003),this.background.lineStyle(3,2719929),this.background.drawRoundedRect(0,0,this.width,this.height,10),this.background.endFill(),this.background.beginFill(6139362),this.background.drawRoundedRect(3,3,this.width-6,this.height-6,8),this.background.endFill(),this.container.addChild(this.background);const t=new a({fontFamily:"Arial",fontSize:36,fill:2899536,align:"center"});this.emojiText=new n(this.emoji,t),this.emojiText.anchor.set(.5),this.emojiText.position.set(this.width/2,this.height/2),this.emojiText.alpha=0,this.container.addChild(this.emojiText)}setupInteraction(){this.container.on("pointerdown",()=>{this.isAnimating||this.isMatched||window.onCardClick(this)}),this.container.on("pointerover",()=>{this.isFlipped||this.isMatched||this.isAnimating||this.container.scale.set(1.05)}),this.container.on("pointerout",()=>{this.isFlipped||this.isMatched||this.isAnimating||this.container.scale.set(1)})}setPosition(t,i){this.container.position.set(t+this.width/2,i+this.height/2)}flip(){this.isAnimating||(this.isAnimating=!0,this.isFlipped=!this.isFlipped,this.isFlipped?this.showEmoji():this.hideEmoji())}showEmoji(){this.container.scale.x=0,this.emojiText.alpha=1,this.background.clear(),this.background.beginFill(16777215),this.background.lineStyle(3,14737632),this.background.drawRoundedRect(0,0,this.width,this.height,10),this.background.endFill();const t=()=>{this.container.scale.x+=.2,this.container.scale.x>=1?(this.container.scale.set(1,1),this.isAnimating=!1):requestAnimationFrame(t)};t()}hideEmoji(){this.container.scale.x=0,this.emojiText.alpha=0,this.background.clear(),this.background.beginFill(3447003),this.background.lineStyle(3,2719929),this.background.drawRoundedRect(0,0,this.width,this.height,10),this.background.endFill(),this.background.beginFill(6139362),this.background.drawRoundedRect(3,3,this.width-6,this.height-6,8),this.background.endFill();const t=()=>{this.container.scale.x+=.2,this.container.scale.x>=1?(this.container.scale.set(1,1),this.isAnimating=!1):requestAnimationFrame(t)};t()}setMatched(){this.isMatched=!0,this.isFlipped=!0;const t=()=>{this.container.alpha-=.05,this.container.alpha>0?requestAnimationFrame(t):this.container.alpha=0};t()}reset(){this.isFlipped=!1,this.isMatched=!1,this.isAnimating=!1,this.container.alpha=1,this.container.scale.set(1),this.emojiText.alpha=0,this.background.clear(),this.background.beginFill(3447003),this.background.lineStyle(3,2719929),this.background.drawRoundedRect(0,0,this.width,this.height,10),this.background.endFill(),this.background.beginFill(6139362),this.background.drawRoundedRect(3,3,this.width-6,this.height-6,8),this.background.endFill()}}const o=800,r=600,c=(()=>{const t=Math.min(710/6,106),i=t/.8;return{cardWidth:Math.floor(t),cardHeight:Math.floor(i),cardPadding:10}})(),l=()=>{const t=window.innerWidth,i=window.innerHeight-120,e=t/o,s=i/r,a=Math.min(e,s);return{gameWidth:o,gameHeight:r,scale:a}},m=["🐶","🐱","🐭","🐹","🐰","🦊","🐻","🐼","🐨","🐯","🦁","🐮","🍎","🍌","🍇","🍓","🍊","🍒","🍑","🍍","🍐","🍋","🥕","🥬","🥦","🌽","🥔","🍅","😂","🤠","🤡","🏀","🏈","⚽","🎾","🏓","🎵","🎤","🎹","🎺","🎻","🔥","⚡","💡"].sort(()=>Math.random()-.5).slice(0,12);class u{constructor(t){i(this,"app"),i(this,"gameContainer"),i(this,"cards",[]),i(this,"flippedCards",[]),i(this,"matchedPairs",0),i(this,"moves",0),i(this,"startTime",0),i(this,"gameTime",0),i(this,"isGameOver",!1),i(this,"isPaused",!1),i(this,"canFlip",!0),i(this,"removeInputHandler"),i(this,"removeTopBarHandler"),i(this,"gameStarted",!1),i(this,"flipTimeout"),this.app=t,this.gameContainer=new e,this.app.stage.addChild(this.gameContainer)}async init(){this.createBackground(),this.createCards(),this.shuffleCards(),this.positionCards(),this.setupInput(),this.setupTopBarEvents(),this.updateUI()}createBackground(){const t=new s;t.beginFill(3426654),t.drawRect(0,0,o,r),t.endFill(),this.gameContainer.addChild(t)}setupTopBarEvents(){const t=t=>{"pause"===t.type?this.togglePause():"menu"===t.type&&this.returnToMainMenu()};document.addEventListener("pause",t),document.addEventListener("menu",t),this.removeTopBarHandler=()=>{document.removeEventListener("pause",t),document.removeEventListener("menu",t)}}createCards(){for(let t=0;t<m.length;t++){const i=m[t],e=new d(c.cardWidth,c.cardHeight,i,2*t),s=new d(c.cardWidth,c.cardHeight,i,2*t+1);this.cards.push(e,s),this.gameContainer.addChild(e.container),this.gameContainer.addChild(s.container)}}shuffleCards(){for(let t=this.cards.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[this.cards[t],this.cards[i]]=[this.cards[i],this.cards[t]]}}positionCards(){const{gameWidth:t,gameHeight:i}=l(),e=(t-(6*(c.cardWidth+c.cardPadding)-c.cardPadding))/2,s=(i-(4*(c.cardHeight+c.cardPadding)-c.cardPadding))/2;for(let a=0;a<this.cards.length;a++){const t=Math.floor(a/6),i=e+a%6*(c.cardWidth+c.cardPadding),n=s+t*(c.cardHeight+c.cardPadding);this.cards[a].setPosition(i,n)}}setupInput(){const t=t=>{this.isGameOver||"Escape"!==t.key||(t.preventDefault(),this.togglePause())};document.addEventListener("keydown",t),this.removeInputHandler=()=>{document.removeEventListener("keydown",t)}}update(t){this.isPaused||this.gameStarted&&!this.isGameOver&&(this.gameTime=Math.floor((Date.now()-this.startTime)/1e3),this.updateUI())}onCardClick(t){if(!(this.isPaused||this.isGameOver||t.isFlipped||t.isMatched)){if(this.gameStarted||(this.gameStarted=!0,this.startTime=Date.now()),2===this.flippedCards.length)return this.flipTimeout&&(clearTimeout(this.flipTimeout),this.flipTimeout=void 0),this.flippedCards[0].flip(),this.flippedCards[1].flip(),this.flippedCards=[],void(this.canFlip=!0);t.flip(),this.flippedCards.push(t),2===this.flippedCards.length&&(this.moves++,this.canFlip=!1,this.flippedCards[0].emoji===this.flippedCards[1].emoji?(this.flippedCards[0].setMatched(),this.flippedCards[1].setMatched(),this.matchedPairs++,this.matchedPairs===m.length&&this.gameOver(),this.flippedCards=[],this.canFlip=!0):this.flipTimeout=setTimeout(()=>{this.flippedCards[0].flip(),this.flippedCards[1].flip(),this.flippedCards=[],this.canFlip=!0,this.flipTimeout=void 0},1e3),this.updateUI())}}gameOver(){this.isGameOver=!0,this.showGameOver()}showGameOver(){const t=document.getElementById("gameOver"),i=document.getElementById("finalMoves"),e=document.getElementById("finalTime");t&&i&&e&&(i.textContent=this.moves.toString(),e.textContent=this.formatTime(this.gameTime),t.style.display="block")}togglePause(){this.isPaused=!this.isPaused,this.isPaused?this.showPauseMenu():this.hidePauseMenu()}showPauseMenu(){const t=document.getElementById("pauseMenu");t&&(t.style.display="block")}hidePauseMenu(){const t=document.getElementById("pauseMenu");t&&(t.style.display="none")}updateUI(){const t=document.getElementById("moves"),i=document.getElementById("pairs"),e=document.getElementById("time");t&&(t.textContent=this.moves.toString()),i&&(i.textContent=this.matchedPairs.toString()),e&&(e.textContent=this.formatTime(this.gameTime))}formatTime(t){const i=t%60;return`${Math.floor(t/60).toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}restart(){this.matchedPairs=0,this.moves=0,this.gameTime=0,this.isGameOver=!1,this.isPaused=!1,this.canFlip=!0,this.gameStarted=!1,this.flippedCards=[],this.flipTimeout&&(clearTimeout(this.flipTimeout),this.flipTimeout=void 0),this.cards.forEach(t=>{t.reset()}),this.shuffleCards(),this.positionCards(),this.startTime=0,this.updateUI();const t=document.getElementById("gameOver");t&&(t.style.display="none"),this.hidePauseMenu()}resume(){this.isPaused=!1,this.hidePauseMenu()}destroy(){this.removeInputHandler&&this.removeInputHandler(),this.removeTopBarHandler&&this.removeTopBarHandler(),this.flipTimeout&&clearTimeout(this.flipTimeout),this.gameContainer&&this.gameContainer.parent&&this.gameContainer.parent.removeChild(this.gameContainer)}returnToMainMenu(){window.location.href="/arcade/"}}let p=null,g=null;function f(){if(!g)return;const t=l(),i=g.view;i.style.width=o*t.scale+"px",i.style.height=r*t.scale+"px"}function w(t){p&&p.update(t)}window.restartGame=()=>{p&&p.restart()},window.returnToMainMenu=()=>{p&&p.returnToMainMenu()},window.resumeGame=()=>{p&&p.resume()},window.togglePause=()=>{p&&p.togglePause()},window.onCardClick=t=>{p&&p.onCardClick(t)},window.addEventListener("load",async function(){const t=l();g=new h({width:o,height:r,backgroundColor:2899536,antialias:!0,resolution:window.devicePixelRatio||1});const i=document.getElementById("gameContainer");if(i){const e=g.view;e.style.width=o*t.scale+"px",e.style.height=r*t.scale+"px",e.style.maxWidth="100%",e.style.maxHeight="100%",e.style.objectFit="contain",i.appendChild(e)}p=new u(g),await p.init(),g.ticker.add(w),window.addEventListener("resize",f)});
